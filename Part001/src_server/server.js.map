{"version":3,"sources":["server.ts"],"names":[],"mappings":"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","file":"server.js","sourcesContent":["import * as express from \"express\";\nimport * as http from \"http\";\nimport * as socketIO from \"socket.io\";\nimport * as path from \"path\";\n\nimport { Player } from \"./Player\";\n//https://salty-depths-71580.herokuapp.com\nclass GameServer\n{\n    private _ioServer: SocketIO.Server;\n    //private _httpServer: http.Server;\n    private _playerList: Player[] = [];\n    private _indexDir: string;\n    private _indexPath: string;\n\n    public constructor()\n    {\n        let dir = path.dirname(__dirname);\n        this._indexDir =  path.join(dir, \"/public\");\n        this._indexPath = path.join(dir, \"/public/treasurehunt.html\");\n\n        //assign it to variable app\n        let app = express();\n        // send a index.html file when a get request is fired to the given \n        // route, which is ‘/’ in this case\n        app.get(\"/\", (req, res) =>\n        {\n            res.sendFile(this._indexPath);\n        });\n\n        // this means when a get request is made to ‘/public’, put all the \n        // static files inside the client folder \n        // Under ‘/public’. See for more details below\n        app.use(\"/\", express.static(this._indexDir));\n        // create a server and pass in app as a request handler\n        let httpServer = http.createServer(app); //Server-11\n        // binds the serv object we created to socket.io\n        this._ioServer = socketIO(httpServer, {});\n        // listen on port 2000\n        httpServer.listen(process.env.PORT || 2000);\n        console.log(\"Server started.\");\n\n        // listen for a connection request from any client\n        this._ioServer.sockets.on(\"connection\", (socket) => { this.OnConnect(socket); });\n    }\n\n    private OnConnect(socket: SocketIO.Socket): void\n    {\n        // output a unique socket.id\n        console.log(`socket connected, id = ${socket.id}`);\n\n        // listen for disconnection;\n        // OnClientdisconnect\n        socket.on('disconnect', () =>\n        {\n            console.log('disconnect');\n            let removePlayer = this.FindPlayerById(socket.id);\n\n            if (removePlayer)\n            {\n                this._playerList.splice(this._playerList.indexOf(removePlayer), 1);\n            }\n\n            console.log(\"removing player \" + socket.id);\n\n            // Send message to every connected client except the sender\n            socket.broadcast.emit('remove_player', { id: socket.id });\n        });\n\n        // Listen for new player\n        // OnNewplayer\n        socket.on(\"new_player\", (data: { x: number, y: number, angle: number, username: string, mysprite: string }) =>\n        {\n            console.log(\"new_player: \" + data);\n            // new player instance\n            let newPlayer = new Player(data.x, data.y, data.angle);\n            console.log(`newPlayer = ${newPlayer}`);\n            console.log(`created new player with username = ${data.username}`);\n            newPlayer.id = socket.id;\n            newPlayer.username = data.username;\n            newPlayer.mysprite = data.mysprite\n            // information to be sent to all clients except sender\n            let currentInfo = {\n                id: newPlayer.id,\n                x: newPlayer.x,\n                y: newPlayer.y,\n                username: newPlayer.username,\n                angle: newPlayer.angle,\n                mysprite: newPlayer.mysprite\n            };\n            // send to the new player about everyone who is already connected\n            for (let i = 0; i < this._playerList.length; i++)\n            {\n                let existingPlayer = this._playerList[i];\n                var playerInfo = {\n                    id: existingPlayer.id,\n                    x: existingPlayer.x,\n                    y: existingPlayer.y,\n                    username: existingPlayer.username,\n                    angle: existingPlayer.angle,\n                    mysprite: existingPlayer.mysprite\n                };\n                console.log(\"pushing player\");\n                // send message to the sender-client only\n                socket.emit(\"new_enemyPlayer\", playerInfo);\n            }\n\n            // send message to every connected client except the sender\n            socket.broadcast.emit('new_enemyPlayer', currentInfo);\n\n            this._playerList.push(newPlayer);\n        });\n\n        // listen for player position update\n        // OnMovePlayer\n        socket.on(\"move_player\", (data: { x: number, y: number, angle: number }) =>\n        {\n            let movePlayer = this.FindPlayerById(socket.id);\n            movePlayer.x = data.x;\n            movePlayer.y = data.y;\n            movePlayer.angle = data.angle;\n\n            let movePlayerData = {\n                id: movePlayer.id,\n                x: movePlayer.x,\n                y: movePlayer.y,\n                angle: movePlayer.angle\n            }\n\n            //console.log(\"move player\");\n\n            //send message to every connected client except the sender\n            socket.broadcast.emit('enemy_move', movePlayerData);\n        });\n    }\n\n    private FindPlayerById(id: string): Player\n    {\n        for (var i = 0; i < this._playerList.length; i++)\n        {\n            if (this._playerList[i].id == id)\n            {\n                return this._playerList[i];\n            }\n        }\n\n        return null;\n    }\n}\n\nnew GameServer();\n"]}